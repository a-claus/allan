


<!doctype html>
<html>
	<head>
		<title>Serviceresor - TLV</title>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		
		<link href="bootstrap/css/bootstrap.css" rel="stylesheet">
		<link rel="stylesheet" href="layout/styleAB.css" type="text/css">
		<link rel="stylesheet" href="layout/styleMap.css" type="text/css">

		<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Lato">
		
		<script src="OpenLayers.js"></script> 
		<script src="inc/js/proj4js-combined.js"></script>
		<script src="inc/js/calender/calendarDateInput.js"></script>	
		<script src="inc/js/bootstrap.min.js"></script>
		
		<link rel="stylesheet" href="layout/jquery-ui.css">
		<script src="inc/js/jquery-ui.js"></script>
		
				
	</head>
	
	<body>
	<div class="header" >
				<div class="logga" >
					<img style="padding-top:7px; padding-left:10px;" src="layout/tlv.jpg" alt="Färdtjänstförvaltningen - Trafiklednings Verktyg"/> 
				</div>

<div class="sokbox">
				<form method="get">
					<select accesskey="A" name="bolag" style="font-size:20px;  padding:0px; margin:0px; height: 32px;  width=170px; float:left;" >
				
					<option value="2">Taxi Göteborg</option><option value="3">HDCom</option><option value="7">Göteborgs buss</option><option value="8">Taxi kurir</option><option  SELECTED value="9">Taxisystem</option><option value="10">Taxiteknik</option>					</select>
					


				   
				  <span style="margin-left:20px;" > 

				  <input type="text" style="height: 30px; font-size:20px;  padding:0px; margin:0px; "  size=5  name="sokid" id="sokid" value ="660" accesskey="S" />
				  <input type="image" style="position: absolute; right:1; top:1; margin-left:-4px; border:0px; "  src="layout/sok.jpg" name="image" accesskey="Q">
				  </span>
				  
				  <input type="hidden" value="" name="s">
				  <input type="hidden" value="gbg" name="karttyp">
				  
				  <input type="hidden" value="" name="datum">
				   <input type="hidden" value="" name="tid">
				   <input type="hidden" value="" name="omfang">
				</form> 
			</div>

				
	<div class="navbox">	
	
		<div class="buttonwrapper">
						<img class="naviSpace" src="layout/naviIconSystem.png" />
			<a class="ovalbuttonActive"								href="index.php?bolag=9&sokid=660&karttyp=gbg" style="margin-left: -2px"><span>Realtid</span></a> 
			
			<a class="ovalbutton"						href="index.php?bolag=9&sokid=660&karttyp=gbg&datum=&tid=&omfang=&historik=&s=historik" style="margin-left: -1px; margin-right: 15px"><span>Historik</span></a>

			
			<img class="naviSpace" src="layout/naviIconMap.png" />
						<a class="ovalbuttonActive"	href="index.php?bolag=9&sokid=660&datum=&tid=&omfang=&historik=&s=&karttyp=gbg" style="margin-left: -2px"><span>GBG</span></a> 
			<a class="ovalbutton"	href="index.php?bolag=9&sokid=660&datum=&tid=&omfang=&historik=&s=&karttyp=lm" style="margin-left: -1px"><span>LM</span></a> 
						<a class="ovalbutton"							href="index.php?bolag=9&sokid=660&datum=&tid=&omfang=&historik=&s=&karttyp=osm" style="margin-left: -1px; margin-right: 15px"><span>OSM</span></a>
	

			
							<img class="naviSpace" src="layout/naviIconAdmin.png" />
				<a class="ovalbutton"	href="http://193.14.232.29/fardnet/system/tlvAdmin/" style="margin-left: -2px"><span>Administration</span></a> 
			
	
		</div>
	</div>

</div>


<div id="overlay">
     <div>
          <p>Sökningen gav ingen träff</p>
		  <a href='#' accesskey="c" onclick='overlay()'>Stäng</a>
     </div>
</div>	<div id="container">
	<div id="infoi">

	<p class="vansterMenyRubrik">Fordonsinformation</p><div class="vansterSokInnehall"><div id="aInfo" class="aInfox" >Blankt var det här</div><p></p></div>


<p class="vansterMenyRubrik">Mina senaste sökningar</p>
<div id="myLatestSearch" class="vansterSokInnehall">
	
<table>
	
	<tr style="border-bottom: 1px solid #6678b1;"  ><td width="227px"><a href="?bolag=9&sokid=660&s=&karttyp=gbg">660 Taxisystem</a></td><td  style="padding-bottom: 5px; padding-top: 2px " > <a href="?bolag=9&sokid=660&karttyp=gbg&datum=&tid=&omfang=&historik=&saveSearch=1033914" class="btn btn-primary btn-sm" role="button"><span class="glyphicon glyphicon-plus"></span></a>      </td></tr><tr style="border-bottom: 1px solid #6678b1;"  ><td width="227px"><a href="?bolag=9&sokid=660&s=&karttyp=gbg">660 Taxisystem</a></td><td  style="padding-bottom: 5px; padding-top: 2px " > <a href="?bolag=9&sokid=660&karttyp=gbg&datum=&tid=&omfang=&historik=&saveSearch=1033913" class="btn btn-primary btn-sm" role="button"><span class="glyphicon glyphicon-plus"></span></a>      </td></tr><tr style="border-bottom: 1px solid #6678b1;"  ><td width="227px"><a href="?bolag=8&sokid=921&s=&karttyp=gbg">921 Taxi kurir</a></td><td  style="padding-bottom: 5px; padding-top: 2px " > <a href="?bolag=9&sokid=660&karttyp=gbg&datum=&tid=&omfang=&historik=&saveSearch=1032141" class="btn btn-primary btn-sm" role="button"><span class="glyphicon glyphicon-plus"></span></a>      </td></tr>	</table>
</div>








<!-- Modal -->
<div class="modal" id="bomModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Hantera bom</h4>
      </div>
      <div class="modal-body">
        Välj om begäran om bom skall godkännas eller inte.
      </div>
      <div class="modal-footer">
        <button type="button" accessbutton="a" class="btn btn-secondary" data-dismiss="modal">Avbryt</button>
        <button type="button" class="btn btn-success">Godkänn</button>
		<button type="button" class="btn btn-danger">Avslå</button>
      </div>
    </div>
  </div>
</div>


<div class="modal" id="nomatch" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
	<div class="modal-content">
	  <div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		  <span aria-hidden="true">&times;</span>
		</button>
		<h4 class="modal-title" id="myModalLabel">Ingen träff</h4>
	  </div>
	  <div class="modal-body">
		Din sökning gav ingen träff.
	  </div>
	  <div class="modal-footer">
		<button type="button" accessbutton="a" class="btn btn-success" data-dismiss="modal">OK</button>
	  </div>
	</div>
  </div>
</div>

<script>
$('#nomatch').draggable();  
</script></div>﻿<div style="height:98%" id="mapdiv"></div>
  
  <script>

Proj4js.defs["EPSG:27700"]  = "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs";
Proj4js.defs["EPSG:3007"] = "+proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs";



				   
		var zoombar = new OpenLayers.Control.PanZoomBar({'position': new OpenLayers.Pixel(100,0) });
		zoombar.position = new OpenLayers.Pixel(150,35);
		


	stadskarta = new OpenLayers.Layer.WMS( "Stadskarta",
	 "http://geodata.sbk.goteborg.se/service/wms/stadskarta/v3",
	{layers: 'stadskarta'});
	
	ortfoto = new OpenLayers.Layer.WMS( "Flygfoto",
	 "http://geodata.sbk.goteborg.se/service/wms/ortofoto/v3?",
	{layers: 'orto'});
	
                map = new OpenLayers.Map ("mapdiv", {
                controls:[
                    new OpenLayers.Control.Navigation(),
                   // new OpenLayers.Control.Zoom(),
                    new OpenLayers.Control.ScaleLine(),
                 //   new OpenLayers.Control.Permalink('permalink'),
                    new OpenLayers.Control.MousePosition(),                    
                    new OpenLayers.Control.Attribution()],
				//	sphericalMercator: true,
					projection: "EPSG:3007",
					units: "m",
					
					resolutions: [80.233454144064439, 40.116727072032219, 20.05836353601611, 10.029181768008055,
									5.0145908840040274, 2.5072954420020137, 1.2536477210010069, 0.62682386050050343,
									0.31341193025025171, 0.15670596512512586],
									
					maxExtent: new OpenLayers.Bounds(124400, 6375000, 172000, 6422000),
					
					restrictedExtent: new OpenLayers.Bounds(124989, 6375448, 185967, 6436185)
				
            } );
			
		map.addControl(new OpenLayers.Control.Scale('scale'));
		map.addControl(new OpenLayers.Control.MousePosition()); 
		map.addControl(new OpenLayers.Control.LayerSwitcher());
		map.addControl(zoombar);





	map.addLayer(stadskarta);
	map.addLayer(ortfoto);
	
    map.zoomToMaxExtent();

/*	
	LmFG = new OpenLayers.Layer.WMS( "LM-Färg Karta",
	 "http://geodata.goteborg.se/kartor/lm/topowebb/wms/v1?",
	{layers: 'topowebbkartan'} );
	map.addLayer(LmFG);
*/	

	
	var proj = new OpenLayers.Projection("EPSG:4326");
	var point = new OpenLayers.LonLat(11.951633, 57.696756);
	point.transform(proj, map.getProjectionObject());
	
	var zoom=4;
	


	
 
var size = new OpenLayers.Size(21,25); 
var offset = new OpenLayers.Pixel(-(size.w/2), -size.h); 


var pastyle = new OpenLayers.Style({
	'pointRadius': 24,
	externalGraphic: '${riktning}' 
});

var fordonkmlurl= 'api/hamtaData/realtidKML.php?bolag=9&r=' + Math.random();

var kmlFordon = new OpenLayers.Layer.Vector("Fordon", {


	styleMap: pastyle,
	projection: new OpenLayers.Projection("EPSG:4326"), 
          strategies: [
		  new OpenLayers.Strategy.Fixed()],
		  
          protocol: new OpenLayers.Protocol.HTTP({
             url: fordonkmlurl,
             format: new OpenLayers.Format.KML({
                extractAttributes: true,
                extractStyles: false
		
            })
          })
});

map.addLayers([kmlFordon]);


							



								 						  


function UpdateKmlLayer(layer) {

	
			// Checking if jQuery is working
			// $('body').append("jQuery running");
			$("#aInfo").html("Ingen fordonsinformation kunde hittas");
			
			/* The script */
		$.ajax({
				type: "GET",
								url: "api/hamtaData/skapaP.php?bolag=9&sokid=660&r=" + Math.random()+Math.random(),
				contentType: "text/xml; charset=utf-8'",
				dataType: "xml",
				cache: false,
				async:false, 
				
				success: function(xml) {
					$(xml).find('position').each(function() {
				//		var id = $(this).find("id").text();
						coordinates = $(this).find("coordinates").text();
						var speed = $(this).find("speed").text();
						var timestamp = $(this).find("timestamp").text();
						
					// $('body').append(Math.random()); 
					//	$('body').append("<p>(" + id + ") " + coordinates + " " + description + "</p>");
					$("#aInfo").html("<b>Fordon: 660</b><br/>Positionstid: " + timestamp + "<br/>" + "Hastighet: " + speed + " km/h");	
					});
					
					
				},
				error: function() {
					$("#aInfo").html("Ingen fordonsinformation kunde hittas");
					
				}
				
			});
			
	
	    var lonLat = new OpenLayers.LonLat.fromString(coordinates)
          .transform(
            new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
            map.getProjectionObject() // to Spherical Mercator Projection
          );
    var zoom=17;
    map.setCenter (lonLat);  
	
	
	kmlFordon.refresh({ force: true, params: { 'key': Math.random()} });

	 
	 
				
}

$(document).ready(function() {
  
     map.setCenter (point, 8)	
	UpdateKmlLayer();
});

window.setInterval(UpdateKmlLayer, 7000);		
</script>


  	<div>
		
		<script type="text/javascript" language="javascript">
				document.getElementById("sokid").focus();
		</script>	

		<script src="inc/js/modal.js"></script>
	</div>
	</div>	
	</body>
</html>